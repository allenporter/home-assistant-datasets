---
uuid: 12c1e8c3-8edb-41f0-8a9d-f9167d4b4d46
task_id: light_on_door_light_on_door-light_on_door-0
model_id: gpt-oss-20b
category: light
task:
  input_text: |
    # Light on door

    ## Problem statement

    Create an blueprint automation to turn on a light when the door opens.

    ## Example use cases

    These are example use cases that could be used with the blueprint:

    - Turn on the pantry light when the pantry door opens

    ## Detailed Description

    The blueprint should accept two inputs:

    | Input          | Description                                                                     |
    | -------------- | ------------------------------------------------------------------------------- |
    | `door_sensor`  | A `binary_sensor` that triggers the automation to start.                        |
    | `light_switch` | One or more `light` entity targets to turn on or off when the automation fires. |

    The automation should trigger when the door opens, and turn the light on. The
    light should be shut off when the door closes or after a 2 minute timeout.
response: "**Home Assistant Blueprint**\n\n```yaml\nblueprint:\n  name: Light on door\n\
  \  description: |\n    Turns on a light when the specified door sensor turns on\
  \ (door opens).  \n    The light is turned off when the sensor turns off (door closes)\
  \ or after\n    the door has been open for 2 minutes.\n  domain: automation\n  input:\n\
  \    door_sensor:\n      name: Door sensor\n      description: Binary sensor that\
  \ indicates door open/closed\n      selector:\n        entity:\n          domain:\
  \ binary_sensor\n    light_switch:\n      name: Lights to control\n      description:\
  \ One or more light entities\n      selector:\n        target:\n          entity:\n\
  \            domain: light\n\ntrigger:\n  - alias: door_open\n    platform: state\n\
  \    entity_id: !input door_sensor\n    to: 'on'\n\n  - alias: door_close\n    platform:\
  \ state\n    entity_id: !input door_sensor\n    to: 'off'\n\n  - alias: door_timeout\n\
  \    platform: state\n    entity_id: !input door_sensor\n    to: 'on'\n    for:\n\
  \      minutes: 2\n\naction:\n  - choose:\n      - conditions:\n          - condition:\
  \ template\n            value_template: \"{{ trigger.alias == 'door_open' }}\"\n\
  \        sequence:\n          - service: light.turn_on\n            target: !input\
  \ light_switch\n\n      - conditions:\n          - condition: template\n       \
  \     value_template: \"{{ trigger.alias in ['door_close', 'door_timeout'] }}\"\n\
  \        sequence:\n          - service: light.turn_off\n            target: !input\
  \ light_switch\n```"
context:
  conversation_trace:
  - event_type: async_process
    data:
      text: |
        # Light on door

        ## Problem statement

        Create an blueprint automation to turn on a light when the door opens.

        ## Example use cases

        These are example use cases that could be used with the blueprint:

        - Turn on the pantry light when the pantry door opens

        ## Detailed Description

        The blueprint should accept two inputs:

        | Input          | Description                                                                     |
        | -------------- | ------------------------------------------------------------------------------- |
        | `door_sensor`  | A `binary_sensor` that triggers the automation to start.                        |
        | `light_switch` | One or more `light` entity targets to turn on or off when the automation fires. |

        The automation should trigger when the door opens, and turn the light on. The
        light should be shut off when the door closes or after a 2 minute timeout.
      context:
        id: 01KF8R0HDVHAJRNGC0D2YZ11BT
        parent_id: null
        user_id: null
      conversation_id: null
      device_id: null
      satellite_id: null
      language: en
      agent_id: conversation.mock_title
      extra_system_prompt: null
    timestamp: 2026-01-18 14:26:43.259172+00:00
  - event_type: agent_detail
    data:
      messages:
      - role: system
        content: |-
          You are a voice assistant for Home Assistant.
          Answer questions about the world truthfully.
          Answer in plain text. Keep it simple and to the point.
          Current time is 06:26:43. Today's date is 2026-01-18.
        created: 2026-01-18 14:26:43.260267+00:00
      - role: user
        content: |
          # Light on door

          ## Problem statement

          Create an blueprint automation to turn on a light when the door opens.

          ## Example use cases

          These are example use cases that could be used with the blueprint:

          - Turn on the pantry light when the pantry door opens

          ## Detailed Description

          The blueprint should accept two inputs:

          | Input          | Description                                                                     |
          | -------------- | ------------------------------------------------------------------------------- |
          | `door_sensor`  | A `binary_sensor` that triggers the automation to start.                        |
          | `light_switch` | One or more `light` entity targets to turn on or off when the automation fires. |

          The automation should trigger when the door opens, and turn the light on. The
          light should be shut off when the door closes or after a 2 minute timeout.
        attachments: null
        created: 2026-01-18 14:26:43.259223+00:00
      - role: assistant
        agent_id: conversation.mock_title
        content: "**Home Assistant Blueprint**\n\n```yaml\nblueprint:\n  name: Light\
          \ on door\n  description: |\n    Turns on a light when the specified door\
          \ sensor turns on (door opens).  \n    The light is turned off when the\
          \ sensor turns off (door closes) or after\n    the door has been open for\
          \ 2 minutes.\n  domain: automation\n  input:\n    door_sensor:\n      name:\
          \ Door sensor\n      description: Binary sensor that indicates door open/closed\n\
          \      selector:\n        entity:\n          domain: binary_sensor\n   \
          \ light_switch:\n      name: Lights to control\n      description: One or\
          \ more light entities\n      selector:\n        target:\n          entity:\n\
          \            domain: light\n\ntrigger:\n  - alias: door_open\n    platform:\
          \ state\n    entity_id: !input door_sensor\n    to: 'on'\n\n  - alias: door_close\n\
          \    platform: state\n    entity_id: !input door_sensor\n    to: 'off'\n\
          \n  - alias: door_timeout\n    platform: state\n    entity_id: !input door_sensor\n\
          \    to: 'on'\n    for:\n      minutes: 2\n\naction:\n  - choose:\n    \
          \  - conditions:\n          - condition: template\n            value_template:\
          \ \"{{ trigger.alias == 'door_open' }}\"\n        sequence:\n          -\
          \ service: light.turn_on\n            target: !input light_switch\n\n  \
          \    - conditions:\n          - condition: template\n            value_template:\
          \ \"{{ trigger.alias in ['door_close', 'door_timeout'] }}\"\n        sequence:\n\
          \          - service: light.turn_off\n            target: !input light_switch\n\
          ```"
        thinking_content: |+
          We need to produce a blueprint YAML. Must be in plain text. Should include input definitions, trigger, condition? action. The blueprint should have two inputs: door_sensor (binary_sensor) and light_switch (target). On open: turn on. On close: turn off. Also if open for 2 minutes: turn off. But we need to think about logic: We can use trigger on door_sensor state change to 'on' and 'off'. But we also need timeout. Approach: Use a single automation with triggers: door_sensor on, door_sensor off, and a delayed trigger: after 2 minutes from open, turn off. Or we can use a single trigger: door_sensor.on, and then in action: turn on light and set timer via 'call service light.turn_on' with delay or use "after" condition? Could use a condition that checks if door still open after 2 minutes. Or easier: use a separate trigger for 'door_sensor off' to turn off. And for the timeout, we can use a trigger with for: 2m, but that requires door_sensor is on for at least 2 minutes. So trigger when door_sensor changes to 'on' for 2 minutes. That would fire if open long. But we want to turn off after 2 minutes. So trigger: door_sensor.on with for: 2m. Action: turn off light.

          Thus we have two triggers: door_sensor on (immediate) and door_sensor.on for 2m. The first triggers to turn on. The second triggers to turn off. The door close triggers also turn off.

          But potential conflict: If door remains open > 2m, we might turn off at 2m but also still be open. That meets spec: turn off after 2 min. Good.

          Edge: When door closed then opened again, need to ensure timer resets. If door closed, we also need to cancel the for trigger? In Home Assistant, for triggers are triggered when the entity stays in state for duration, so if door closed earlier, the for trigger may not fire. If door reopened, it will start counting again. Good.

          Thus blueprint:

          blueprint:
            name: Light on door
            description: Turn on light when door opens, turn off when door closes or after 2 minutes.
            domain: automation
            input:
              door_sensor:
                name: Door sensor
                description: Binary sensor that indicates door state
                selector:
                  entity:
                    domain: binary_sensor
              light_switch:
                name: Light to control
                description: Light(s) to turn on/off
                selector:
                  target:
                    entity:
                      domain: light
            trigger:
              - platform: state
                entity_id: !input door_sensor
                to: 'on'
              - platform: state
                entity_id: !input door_sensor
                to: 'off'
              - platform: state
                entity_id: !input door_sensor
                to: 'on'
                for:
                  minutes: 2
            action:
              - choose:
                  - conditions:
                      - condition: state
                        entity_id: !input door_sensor
                        state: 'on'
                    sequence:
                      - service: light.turn_on
                        target: !input light_switch
                  - conditions:
                      - condition: or
                        conditions:
                          - condition: state
                            entity_id: !input door_sensor
                            state: 'off'
                          - condition: state
                            entity_id: !input door_sensor
                            state: 'on'
                          - condition: template
                            value_template: "{{ trigger.for is not none }}"
                    sequence:
                      - service: light.turn_off
                        target: !input light_switch

          Wait choose may not be necessary: we can separate actions by trigger type. Simpler: Use separate trigger with different actions: For the open trigger, action turn_on. For the close trigger, action turn_off. For the for trigger, action turn_off.

          We can use multiple triggers each with action? In blueprint we can define triggers array, but each trigger can have an "action" field? In HA automation, triggers array can't have actions. But we can use trigger alias? Actually we can use a single trigger array with a condition in action referencing trigger.id or use 'if' to differentiate. However simplest: use trigger array and in action use 'choose' based on trigger.platform? But there is trigger.id property? We can set alias for each trigger. But maybe easier: Use trigger with alias and in action choose based on alias. But blueprint may support trigger.id?

          Better: Use separate triggers each with separate actions using the "trigger" and "action" in a mapping? I think the automation spec doesn't support per-trigger action. So we need to use choose.

          Thus create 3 triggers:

          - door_sensor open: alias "door_open"
          - door_sensor close: alias "door_close"
          - door_sensor open for 2m: alias "door_timeout"

          In action:

          - choose: if trigger.alias == 'door_open' => turn_on
          - if alias == 'door_close' or alias == 'door_timeout' => turn_off

          We can use template to compare.

          But we can use 'trigger.platform' not alias? Might be easier: use condition: trigger.entity_id equals door_sensor and trigger.to is 'on' for open, etc. But we already have separate triggers.

          Simplify: Use only 2 triggers: open and close. For timeout, use 'for' on the open trigger? But that would trigger the same open trigger, not distinct. We could add an action that uses wait_for_trigger? But that's complex.

          Alternatively, we can use two triggers: open and close. In action for open, we turn_on. Then we set a timer using service 'timer.start' or 'script' to call turn_off after 2 min. But we need to cancel if door closed earlier. Hard.

          Thus better to keep 3 triggers with choose.

          Let's build blueprint accordingly.

          Also ensure selector uses "target" for light_switch.

          Ok produce final YAML.

        tool_calls: null
        native: null
        created: 2026-01-18 14:26:54.593600+00:00
      tools: null
    timestamp: 2026-01-18 14:26:43.260274+00:00
  duration_ms: 11334.57
  tries: 1
