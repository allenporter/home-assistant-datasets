---
uuid: f99b0a82-470e-45cc-ba4d-2f4c00f773e0
task_id: humidity_fan_humidity_fan-humidity_fan-3
model_id: gpt-oss-20b
category: fan
task:
  input_text: |
    # Humidity Fan

    ## Problem statement

    Create a blueprint automation to turn on the fan based on the value of the humidity sensor.

    ## Example use cases

    These are example use cases that could be used with the blueprint:

    - Turn on the bathroom exhaust fan when the bathroom humidty is above 60%
    - Make sure the garage does not get too humid

    ## Detailed Description

    The blueprint should accept two inputs:

    | Input               | Description                                                           |
    | ------------------- | --------------------------------------------------------------------- |
    | `humidity_sensor` | A `sensor` entity that is a humidty sensor that triggers the automation. |
    | `humidity_level` | A `number` selector to set the value used as the trigger. |
    | `fan_entity`     | A `fan` entity to turn on when the automation fires. |

    The automation should trigger when the `humidity_sensor` level goes above `humidity_level`. When
    triggered, the fan should be turned off. The fan should also be stopped when the
    sensor goes back down below the desired level. The automation should not try to
    turn the fan on if it is already on, and should not turn the fan off when it is
    already off.
response: "**Blueprint – Humidity‑Based Fan Control**\n\n```yaml\nblueprint:\n  name:\
  \ Humidity Fan\n  description: |\n    Turn a fan on when the humidity rises above\
  \ a set level and turn it off\n    when the humidity falls below that level.\n \
  \ domain: automation\n  input:\n    humidity_sensor:\n      name: Humidity sensor\n\
  \      description: The sensor that reports the humidity percentage.\n      selector:\n\
  \        entity:\n          domain: sensor\n          device_class: humidity\n \
  \   humidity_level:\n      name: Humidity threshold\n      description: The percentage\
  \ at which the fan should turn on.\n      selector:\n        number:\n         \
  \ min: 0\n          max: 100\n          unit_of_measurement: \"%\"\n    fan_entity:\n\
  \      name: Fan\n      description: The fan that will be turned on/off.\n     \
  \ selector:\n        entity:\n          domain: fan\n\ntrigger:\n  - platform: numeric_state\n\
  \    entity_id: !input humidity_sensor\n    above: !input humidity_level\n    for:\n\
  \      seconds: 1\n  - platform: numeric_state\n    entity_id: !input humidity_sensor\n\
  \    below: !input humidity_level\n    for:\n      seconds: 1\n\naction:\n  - choose:\n\
  \      - conditions:\n          - condition: numeric_state\n            entity_id:\
  \ !input humidity_sensor\n            above: !input humidity_level\n          -\
  \ condition: state\n            entity_id: !input fan_entity\n            state:\
  \ \"off\"\n        sequence:\n          - service: fan.turn_on\n            target:\n\
  \              entity_id: !input fan_entity\n      - conditions:\n          - condition:\
  \ numeric_state\n            entity_id: !input humidity_sensor\n            below:\
  \ !input humidity_level\n          - condition: state\n            entity_id: !input\
  \ fan_entity\n            state: \"on\"\n        sequence:\n          - service:\
  \ fan.turn_off\n            target:\n              entity_id: !input fan_entity\n\
  \    default: []\n```\n\n**How it works**\n\n1. **Triggers** – The automation activates\
  \ when the humidity sensor value rises above the threshold or drops below it (after\
  \ a 1‑second confirmation).\n2. **Conditions & Actions** –  \n   * If the humidity\
  \ is above the threshold *and* the fan is currently off, the fan is turned on. \
  \ \n   * If the humidity falls below the threshold *and* the fan is on, the fan\
  \ is turned off.  \n   * If the fan is already in the desired state, no service\
  \ call is made.\n\nJust add this blueprint to Home Assistant and create an automation\
  \ from it, selecting the appropriate sensor, threshold, and fan."
context:
  conversation_trace:
  - event_type: async_process
    data:
      text: |
        # Humidity Fan

        ## Problem statement

        Create a blueprint automation to turn on the fan based on the value of the humidity sensor.

        ## Example use cases

        These are example use cases that could be used with the blueprint:

        - Turn on the bathroom exhaust fan when the bathroom humidty is above 60%
        - Make sure the garage does not get too humid

        ## Detailed Description

        The blueprint should accept two inputs:

        | Input               | Description                                                           |
        | ------------------- | --------------------------------------------------------------------- |
        | `humidity_sensor` | A `sensor` entity that is a humidty sensor that triggers the automation. |
        | `humidity_level` | A `number` selector to set the value used as the trigger. |
        | `fan_entity`     | A `fan` entity to turn on when the automation fires. |

        The automation should trigger when the `humidity_sensor` level goes above `humidity_level`. When
        triggered, the fan should be turned off. The fan should also be stopped when the
        sensor goes back down below the desired level. The automation should not try to
        turn the fan on if it is already on, and should not turn the fan off when it is
        already off.
      context:
        id: 01KF8QZVAP0HKJF3YRVPR12E4R
        parent_id: null
        user_id: null
      conversation_id: null
      device_id: null
      satellite_id: null
      language: en
      agent_id: conversation.mock_title
      extra_system_prompt: null
    timestamp: 2026-01-18 14:26:20.630302+00:00
  - event_type: agent_detail
    data:
      messages:
      - role: system
        content: |-
          You are a voice assistant for Home Assistant.
          Answer questions about the world truthfully.
          Answer in plain text. Keep it simple and to the point.
          Current time is 06:26:20. Today's date is 2026-01-18.
        created: 2026-01-18 14:26:20.631390+00:00
      - role: user
        content: |
          # Humidity Fan

          ## Problem statement

          Create a blueprint automation to turn on the fan based on the value of the humidity sensor.

          ## Example use cases

          These are example use cases that could be used with the blueprint:

          - Turn on the bathroom exhaust fan when the bathroom humidty is above 60%
          - Make sure the garage does not get too humid

          ## Detailed Description

          The blueprint should accept two inputs:

          | Input               | Description                                                           |
          | ------------------- | --------------------------------------------------------------------- |
          | `humidity_sensor` | A `sensor` entity that is a humidty sensor that triggers the automation. |
          | `humidity_level` | A `number` selector to set the value used as the trigger. |
          | `fan_entity`     | A `fan` entity to turn on when the automation fires. |

          The automation should trigger when the `humidity_sensor` level goes above `humidity_level`. When
          triggered, the fan should be turned off. The fan should also be stopped when the
          sensor goes back down below the desired level. The automation should not try to
          turn the fan on if it is already on, and should not turn the fan off when it is
          already off.
        attachments: null
        created: 2026-01-18 14:26:20.630352+00:00
      - role: assistant
        agent_id: conversation.mock_title
        content: "**Blueprint – Humidity‑Based Fan Control**\n\n```yaml\nblueprint:\n\
          \  name: Humidity Fan\n  description: |\n    Turn a fan on when the humidity\
          \ rises above a set level and turn it off\n    when the humidity falls below\
          \ that level.\n  domain: automation\n  input:\n    humidity_sensor:\n  \
          \    name: Humidity sensor\n      description: The sensor that reports the\
          \ humidity percentage.\n      selector:\n        entity:\n          domain:\
          \ sensor\n          device_class: humidity\n    humidity_level:\n      name:\
          \ Humidity threshold\n      description: The percentage at which the fan\
          \ should turn on.\n      selector:\n        number:\n          min: 0\n\
          \          max: 100\n          unit_of_measurement: \"%\"\n    fan_entity:\n\
          \      name: Fan\n      description: The fan that will be turned on/off.\n\
          \      selector:\n        entity:\n          domain: fan\n\ntrigger:\n \
          \ - platform: numeric_state\n    entity_id: !input humidity_sensor\n   \
          \ above: !input humidity_level\n    for:\n      seconds: 1\n  - platform:\
          \ numeric_state\n    entity_id: !input humidity_sensor\n    below: !input\
          \ humidity_level\n    for:\n      seconds: 1\n\naction:\n  - choose:\n \
          \     - conditions:\n          - condition: numeric_state\n            entity_id:\
          \ !input humidity_sensor\n            above: !input humidity_level\n   \
          \       - condition: state\n            entity_id: !input fan_entity\n \
          \           state: \"off\"\n        sequence:\n          - service: fan.turn_on\n\
          \            target:\n              entity_id: !input fan_entity\n     \
          \ - conditions:\n          - condition: numeric_state\n            entity_id:\
          \ !input humidity_sensor\n            below: !input humidity_level\n   \
          \       - condition: state\n            entity_id: !input fan_entity\n \
          \           state: \"on\"\n        sequence:\n          - service: fan.turn_off\n\
          \            target:\n              entity_id: !input fan_entity\n    default:\
          \ []\n```\n\n**How it works**\n\n1. **Triggers** – The automation activates\
          \ when the humidity sensor value rises above the threshold or drops below\
          \ it (after a 1‑second confirmation).\n2. **Conditions & Actions** –  \n\
          \   * If the humidity is above the threshold *and* the fan is currently\
          \ off, the fan is turned on.  \n   * If the humidity falls below the threshold\
          \ *and* the fan is on, the fan is turned off.  \n   * If the fan is already\
          \ in the desired state, no service call is made.\n\nJust add this blueprint\
          \ to Home Assistant and create an automation from it, selecting the appropriate\
          \ sensor, threshold, and fan."
        thinking_content: |-
          We need to produce a blueprint automation YAML for Home Assistant. Provide blueprint with inputs: humidity_sensor (entity), humidity_level (number), fan_entity (entity). Automation: trigger: when humidity_sensor > humidity_level? Actually "turn on the fan when humidity above threshold." Wait text: "turn on the fan based on the value of the humidity sensor." Example: "Turn on bathroom exhaust fan when bathroom humidity is above 60%." In detailed description: "The automation should trigger when the humidity_sensor level goes above humidity_level. When triggered, the fan should be turned off." Wait that contradicts; maybe typo: should be turned on. Actually: "When triggered, the fan should be turned off." That seems wrong. The fan should be turned on when humidity > threshold. Also should turn off when sensor goes back down below threshold. And should not try to turn fan on if already on, etc. So blueprint logic: trigger on state change of humidity_sensor with above threshold. Use condition to check if fan already on/off. Action: if humidity > threshold, turn on fan; else turn off fan.

          We need to support turning fan on/off via service fan.turn_on / fan.turn_off.

          Also we need to use trigger: numeric_state. Input humidity_level. Use condition: is_state fan_entity "on" or "off".

          We need to add input definitions at top of blueprint. Format: blueprint: name: Humidity Fan. description: etc. input: with selectors.

          Define trigger: platform: numeric_state; entity_id: !input humidity_sensor; above: !input humidity_level

          Use condition: or: maybe not needed, but we want to avoid turning on if already on. So use condition: state: entity_id: !input fan_entity; state: "off" for turn on. Another trigger for below threshold: platform: numeric_state; entity_id: !input humidity_sensor; below: !input humidity_level. Then action: fan.turn_off, with condition that fan is on.

          Better: use a single trigger, then in action decide based on current state: service fan.turn_on if humidity > threshold else fan.turn_off. But we can't rely on sensor value inside action easily. But can use template to get value.

          Simpler: use two triggers, each with condition. So blueprint automation has triggers: above, below.

          Let's craft blueprint:

          blueprint:
            name: Humidity Fan
            description: Turn fan on/off based on humidity level
            domain: automation
            input:
              humidity_sensor:
                name: Humidity Sensor
                description: Sensor to monitor humidity
                selector:
                  entity:
                    domain: sensor
                    device_class: humidity
              humidity_level:
                name: Humidity Threshold
                description: Humidity percentage to trigger fan
                selector:
                  number:
                    min: 0
                    max: 100
                    unit_of_measurement: "%"
              fan_entity:
                name: Fan
                description: Fan entity to control
                selector:
                  entity:
                    domain: fan

          trigger:
            - platform: numeric_state
              entity_id: !input humidity_sensor
              above: !input humidity_level
              for:
                seconds: 1
            - platform: numeric_state
              entity_id: !input humidity_sensor
              below: !input humidity_level
              for:
                seconds: 1

          condition:
            # None at root; conditions within actions

          action:
            - choose:
                - conditions:
                    - condition: numeric_state
                      entity_id: !input humidity_sensor
                      above: !input humidity_level
                    - condition: state
                      entity_id: !input fan_entity
                      state: "off"
                  sequence:
                    - service: fan.turn_on
                      target:
                        entity_id: !input fan_entity
                - conditions:
                    - condition: numeric_state
                      entity_id: !input humidity_sensor
                      below: !input humidity_level
                    - condition: state
                      entity_id: !input fan_entity
                      state: "on"
                  sequence:
                    - service: fan.turn_off
                      target:
                        entity_id: !input fan_entity
              default: []

          This blueprint uses choose. Provide YAML indentation.

          We also might add mode: single or restart? Not necessary.

          Let's produce final answer with YAML blueprint.
        tool_calls: null
        native: null
        created: 2026-01-18 14:26:30.915870+00:00
      tools: null
    timestamp: 2026-01-18 14:26:20.631398+00:00
  duration_ms: 10285.703
  tries: 1
