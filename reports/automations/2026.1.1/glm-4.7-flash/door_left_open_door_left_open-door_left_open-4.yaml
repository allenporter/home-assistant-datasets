---
uuid: 746ab6d9-6c9f-473b-929d-a226efc78b6e
task_id: door_left_open_door_left_open-door_left_open-4
model_id: glm-4.7-flash
category: media_player
task:
  input_text: |
    # Door left open

    ## Problem statement

    Create an blueprint automation to play an alert on the speaker when the door is
    left open.

    ## Example use cases

    These are example use cases that could be used with the blueprint:

    - Play an message on the living room speaker if the garage door has been left open for more than 30 minutes
    - When the front door is ajar for 5 minutes, play a sound on the kitchen bluetooth speaker.

    ## Detailed Description

    The blueprint should accept two inputs:

    | Input           | Selector Type | Description                                                                           |
    | --------------- | ------------- | ------------------------------------------------------------------------------------- |
    | `door_sensor`   | `entity`      | A `binary_sensor` entity selector door sensor that is the target of the automation.   |
    | `alert_media`   | `media`       | The target for the `media` selector for the media player and media id with the alter. |
    | `open_duration` | `duration`    | A `duration` selector, the amount of time before playing the alert.                   |

    The automation should play the selected media when the door has been open for the specified duration.
response: |-
  ```yaml
  blueprints:
    id: "door_left_open_alert"
    name: "Door Left Open Alert"
    domain: automation

    input:
      door_sensor:
        name: Door Sensor
        selector:
          entity:
            domain: binary_sensor

      alert_media:
        name: Alert Media
        description: Select the media player and the specific media ID to play.
        selector:
          media:
            media_player: []
            media_id: ''

      open_duration:
        name: Open Duration
        description: Time the door must remain open before the alert plays.
        selector:
          duration: {}

    trigger:
      - platform: state
          entity_id: !input door_sensor
          to: 'on'
          for: !input open_duration

    action:
      - service: media_player.play_media
        target:
          entity_id: !input alert_media.media_player
        data:
          media_content_id: !input alert_media.media_id
          media_content_type: audio

    mode: single
  ```
context:
  conversation_trace:
  - event_type: async_process
    data:
      text: |
        # Door left open

        ## Problem statement

        Create an blueprint automation to play an alert on the speaker when the door is
        left open.

        ## Example use cases

        These are example use cases that could be used with the blueprint:

        - Play an message on the living room speaker if the garage door has been left open for more than 30 minutes
        - When the front door is ajar for 5 minutes, play a sound on the kitchen bluetooth speaker.

        ## Detailed Description

        The blueprint should accept two inputs:

        | Input           | Selector Type | Description                                                                           |
        | --------------- | ------------- | ------------------------------------------------------------------------------------- |
        | `door_sensor`   | `entity`      | A `binary_sensor` entity selector door sensor that is the target of the automation.   |
        | `alert_media`   | `media`       | The target for the `media` selector for the media player and media id with the alter. |
        | `open_duration` | `duration`    | A `duration` selector, the amount of time before playing the alert.                   |

        The automation should play the selected media when the door has been open for the specified duration.
      context:
        id: 01KG0818BMJSCGRY656VRAK9JB
        parent_id: null
        user_id: null
      conversation_id: null
      device_id: null
      satellite_id: null
      language: en
      agent_id: conversation.mock_title
      extra_system_prompt: null
    timestamp: 2026-01-27 17:29:15.892792+00:00
  - event_type: agent_detail
    data:
      messages:
      - role: system
        content: |-
          You are a voice assistant for Home Assistant.
          Answer questions about the world truthfully.
          Answer in plain text. Keep it simple and to the point.
          Current time is 09:29:15. Today's date is 2026-01-27.
        created: 2026-01-27 17:29:15.893889+00:00
      - role: user
        content: |
          # Door left open

          ## Problem statement

          Create an blueprint automation to play an alert on the speaker when the door is
          left open.

          ## Example use cases

          These are example use cases that could be used with the blueprint:

          - Play an message on the living room speaker if the garage door has been left open for more than 30 minutes
          - When the front door is ajar for 5 minutes, play a sound on the kitchen bluetooth speaker.

          ## Detailed Description

          The blueprint should accept two inputs:

          | Input           | Selector Type | Description                                                                           |
          | --------------- | ------------- | ------------------------------------------------------------------------------------- |
          | `door_sensor`   | `entity`      | A `binary_sensor` entity selector door sensor that is the target of the automation.   |
          | `alert_media`   | `media`       | The target for the `media` selector for the media player and media id with the alter. |
          | `open_duration` | `duration`    | A `duration` selector, the amount of time before playing the alert.                   |

          The automation should play the selected media when the door has been open for the specified duration.
        attachments: null
        created: 2026-01-27 17:29:15.892855+00:00
      - role: assistant
        agent_id: conversation.mock_title
        content: |-
          ```yaml
          blueprints:
            id: "door_left_open_alert"
            name: "Door Left Open Alert"
            domain: automation

            input:
              door_sensor:
                name: Door Sensor
                selector:
                  entity:
                    domain: binary_sensor

              alert_media:
                name: Alert Media
                description: Select the media player and the specific media ID to play.
                selector:
                  media:
                    media_player: []
                    media_id: ''

              open_duration:
                name: Open Duration
                description: Time the door must remain open before the alert plays.
                selector:
                  duration: {}

            trigger:
              - platform: state
                  entity_id: !input door_sensor
                  to: 'on'
                  for: !input open_duration

            action:
              - service: media_player.play_media
                target:
                  entity_id: !input alert_media.media_player
                data:
                  media_content_id: !input alert_media.media_id
                  media_content_type: audio

            mode: single
          ```
        thinking_content: |-
          1.  **Analyze the Request:**
              *   **Goal:** Create a Home Assistant blueprint automation.
              *   **Trigger:** A door binary sensor remains in the "on" (open) state for a specific duration (`open_duration`).
              *   **Action:** Play a specific media (`alert_media`) on a target speaker (`media_player`).
              *   **Inputs Required:**
                  *   `door_sensor` (Entity selector, binary_sensor).
                  *   `alert_media` (Media selector, media_player + media_id).
                  *   `open_duration` (Duration selector).
              *   **Context:** Current time is 2026-01-27 09:29:15 (irrelevant to the blueprint structure itself, but good for reference).

          2.  **Identify the Core Logic:**
              *   I need to monitor a binary sensor.
              *   I need to check *how long* it has been "on".
              *   Standard Home Assistant way to do "state is X for duration" is using the `template` platform with `state` > `duration` or the newer `trigger` platform with `for`.
              *   *Option A (Trigger `for`):*
                  ```yaml
                  trigger:
                    - platform: state
                      entity_id: door_sensor
                      to: 'on'
                      for: "{{ open_duration }}"
                  ```
                  *Critique:* This triggers immediately when the door opens and waits for the duration. If the door is *already* open when HA restarts, the "time open" starts from 0, even if it was open for 20 minutes.
              *   *Option B (Template Trigger):*
                  ```yaml
                  trigger:
                    - platform: template
                      value_template: "{{ (as_timestamp(now()) - as_timestamp(states[door_sensor].last_changed)) | int >= open_duration }}"
                  ```
                  *Critique:* This requires the `open_duration` input to be converted to seconds or milliseconds for the comparison, or uses a specific template integration. However, `last_changed` is the timestamp the state last changed. If the state is `on`, we check if `now - last_changed >= duration`.
              *   *Option C (State > Duration):*
                  ```yaml
                  trigger:
                    - platform: numeric_state
                      entity_id: door_sensor
                      above: 0
                      for: "{{ open_duration }}"
                  ```
                  *Critique:* `binary_sensor` doesn't have a numeric state. It has a boolean.

              *   *Refining Option A (Trigger `for`):* While it might not handle reboots perfectly (starting the timer over), it is the simplest and most standard "for duration" pattern in modern HA blueprints unless state persistence is strictly required for pre-existing open doors. The prompt asks for a "blueprint automation" and usually, these are assumed to start when configured. Let's stick to the standard `for` trigger for simplicity and readability.

          3.  **Drafting the Blueprint Structure:**

              ```yaml
              blueprints:
                id: ...
                name: ...
                domain: automation

                input:
                  door_sensor:
                    name: Door Sensor
                    selector:
                      entity:
                        domain: binary_sensor

                  alert_media:
                    name: Alert Media
                    selector:
                      media:
                        media_player: ...
                        media_id: ...

                  open_duration:
                    name: Open Duration
                    selector:
                      duration: ...

                trigger:
                  - platform: state
                      entity_id: !input door_sensor
                      to: 'on'
                      for: !input open_duration

                condition: []

                action:
                  - service: media_player.play_media
                    target:
                      entity_id: !input alert_media.media_player
                    data:
                      media_content_id: !input alert_media.media_id
                      media_content_type: audio

                mode: single
              ```

          4.  **Refining the Media Selector:**
              The prompt asks for "The target for the `media` selector for the media player and media id with the alter."
              In YAML, a selector is a structure.
              Selector definition: `{ type: media, media_player: ..., media_id: ... }`
              Input variable name: `alert_media`
              Usage in `target`: `!input alert_media.media_player`
              Usage in `data`: `!input alert_media.media_id`

              Wait, strictly speaking, the `media` selector in HA blueprints takes the player entity and the ID.
              The selector structure usually looks like this in the input definition if defined manually, but here the user specifies it's a selector.
              However, usually, in a blueprint input, you define the selector type.

              Let's verify the structure of the media selector input.
              Input: `alert_media`
              Selector Type: `media`
              Selector Content: `{ media_player: ... }`

              In the `action`:
              `target: !input alert_media.media_player` (This gets the entity_id)
              `data: { media_content_id: !input alert_media.media_id, media_content_type: 'audio' }` (This gets the ID)

          5.  **Handling the `open_duration` input:**
              The `duration` selector is standard.

          6.  **Final Polish:**
              *   Add a `mode: single` to prevent overlapping alerts if the user toggles the door off and on again (though the condition `to: 'on'` prevents this, `mode: single` is good practice).
              *   Ensure clear naming in the blueprint UI (inputs).

          7.  **Constructing the YAML:**

              ```yaml
              blueprints:
                id: "door_left_open_alert"
                name: "Door Left Open Alert"
                domain: automation

                input:
                  door_sensor:
                    name: Door Sensor
                    description: The binary sensor representing the door state.
                    selector:
                      entity:
                        domain: binary_sensor

                  alert_media:
                    name: Alert Media
                    description: The media player and media content ID to play.
                    selector:
                      media:
                        media_player: ...
                        media_id: ...

                  open_duration:
                    name: Open Duration
                    description: How long the door must stay open before playing.
                    selector:
                      duration: {}

                trigger:
                  - platform: state
                      entity_id: !input door_sensor
                      to: 'on'
                      for: !input open_duration

                action:
                  - service: media_player.play_media
                    target:
                      entity_id: !input alert_media.media_player
                    data:
                      media_content_id: !input alert_media.media_id
                      media_content_type: audio

                mode: single
              ```

          8.  **Double Check Prompt Requirements:**
              *   `door_sensor`: Entity selector, binary_sensor. (Check)
              *   `alert_media`: Media selector (media_player + media_id). (Check)
              *   `open_duration`: Duration selector. (Check)
              *   Play media when open for duration. (Check)

              *Self-Correction on `alert_media` selector format:*
              The prompt says: "The target for the `media` selector for the media player and media id with the alter."
              This implies the input is a dictionary containing `media_player` and `media_id`.
              So `!input alert_media` yields `{ media_player: <entity>, media_id: <id> }`.
              The service `media_player.play_media` expects `entity_id` in `target` and `media_content_id` in `data`.

          9.  **Final Output Generation:** (Plain text, simple).

              ```yaml
              blueprints:
                id: "door_left_open_alert"
                name: "Door Left Open Alert"
                domain: automation

                input:
                  door_sensor:
                    name: Door Sensor
                    selector:
                      entity:
                        domain: binary_sensor

                  alert_media:
                    name: Alert Media
                    selector:
                      media:
                        media_player: []
                        media_id: ''

                  open_duration:
                    name: Open Duration
                    selector:
                      duration: {}

                trigger:
                  - platform: state
                      entity_id: !input door_sensor
                      to: 'on'
                      for: !input open_duration

                action:
                  - service: media_player.play_media
                    target:
                      entity_id: !input alert_media.media_player
                    data:
                      media_content_id: !input alert_media.media_id
                      media_content_type: audio

                mode: single
              ```

              This looks correct and robust.
        tool_calls: null
        native: null
        created: 2026-01-27 17:29:36.010415+00:00
      tools: null
    timestamp: 2026-01-27 17:29:15.893897+00:00
  duration_ms: 20117.767
  tries: 1
