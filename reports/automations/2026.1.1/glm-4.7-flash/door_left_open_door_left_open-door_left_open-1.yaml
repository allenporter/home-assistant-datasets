---
uuid: 1805000a-7c5a-4caf-9a78-645d2946d61f
task_id: door_left_open_door_left_open-door_left_open-1
model_id: glm-4.7-flash
category: media_player
task:
  input_text: |
    # Door left open

    ## Problem statement

    Create an blueprint automation to play an alert on the speaker when the door is
    left open.

    ## Example use cases

    These are example use cases that could be used with the blueprint:

    - Play an message on the living room speaker if the garage door has been left open for more than 30 minutes
    - When the front door is ajar for 5 minutes, play a sound on the kitchen bluetooth speaker.

    ## Detailed Description

    The blueprint should accept two inputs:

    | Input           | Selector Type | Description                                                                           |
    | --------------- | ------------- | ------------------------------------------------------------------------------------- |
    | `door_sensor`   | `entity`      | A `binary_sensor` entity selector door sensor that is the target of the automation.   |
    | `alert_media`   | `media`       | The target for the `media` selector for the media player and media id with the alter. |
    | `open_duration` | `duration`    | A `duration` selector, the amount of time before playing the alert.                   |

    The automation should play the selected media when the door has been open for the specified duration.
response: |-
  ```yaml
  blueprints:
    - alias: "Alert when door is left open"
      description: "Plays an alert on the media player when a door sensor has been in the 'on' state for a specified duration."
      variables:
        door_sensor:
          name: Door Sensor
          description: The binary sensor entity that indicates the door is open.
          selector:
            entity:
              domain: binary_sensor
        alert_media:
          name: Alert Media
          description: The media player entity and the media content ID to play.
          selector:
            media:
        open_duration:
          name: Duration
          description: The amount of time the door must remain open before alerting.
          selector:
            duration:
      trigger:
        - platform: state
          entity_id: "{{ variables.door_sensor }}"
          to: "on"
          for: "{{ variables.open_duration }}"
      action:
        - service: media_player.play_media
          target:
            entity_id: "{{ variables.alert_media.entity_id }}"
          data:
            media_content_id: "{{ variables.alert_media.media_content_id }}"
      mode: single
  ```
context:
  conversation_trace:
  - event_type: async_process
    data:
      text: |
        # Door left open

        ## Problem statement

        Create an blueprint automation to play an alert on the speaker when the door is
        left open.

        ## Example use cases

        These are example use cases that could be used with the blueprint:

        - Play an message on the living room speaker if the garage door has been left open for more than 30 minutes
        - When the front door is ajar for 5 minutes, play a sound on the kitchen bluetooth speaker.

        ## Detailed Description

        The blueprint should accept two inputs:

        | Input           | Selector Type | Description                                                                           |
        | --------------- | ------------- | ------------------------------------------------------------------------------------- |
        | `door_sensor`   | `entity`      | A `binary_sensor` entity selector door sensor that is the target of the automation.   |
        | `alert_media`   | `media`       | The target for the `media` selector for the media player and media id with the alter. |
        | `open_duration` | `duration`    | A `duration` selector, the amount of time before playing the alert.                   |

        The automation should play the selected media when the door has been open for the specified duration.
      context:
        id: 01KG07YXM583AS2KCENAEDNAQG
        parent_id: null
        user_id: null
      conversation_id: null
      device_id: null
      satellite_id: null
      language: en
      agent_id: conversation.mock_title
      extra_system_prompt: null
    timestamp: 2026-01-27 17:27:59.365505+00:00
  - event_type: agent_detail
    data:
      messages:
      - role: system
        content: |-
          You are a voice assistant for Home Assistant.
          Answer questions about the world truthfully.
          Answer in plain text. Keep it simple and to the point.
          Current time is 09:27:59. Today's date is 2026-01-27.
        created: 2026-01-27 17:27:59.366682+00:00
      - role: user
        content: |
          # Door left open

          ## Problem statement

          Create an blueprint automation to play an alert on the speaker when the door is
          left open.

          ## Example use cases

          These are example use cases that could be used with the blueprint:

          - Play an message on the living room speaker if the garage door has been left open for more than 30 minutes
          - When the front door is ajar for 5 minutes, play a sound on the kitchen bluetooth speaker.

          ## Detailed Description

          The blueprint should accept two inputs:

          | Input           | Selector Type | Description                                                                           |
          | --------------- | ------------- | ------------------------------------------------------------------------------------- |
          | `door_sensor`   | `entity`      | A `binary_sensor` entity selector door sensor that is the target of the automation.   |
          | `alert_media`   | `media`       | The target for the `media` selector for the media player and media id with the alter. |
          | `open_duration` | `duration`    | A `duration` selector, the amount of time before playing the alert.                   |

          The automation should play the selected media when the door has been open for the specified duration.
        attachments: null
        created: 2026-01-27 17:27:59.365564+00:00
      - role: assistant
        agent_id: conversation.mock_title
        content: |-
          ```yaml
          blueprints:
            - alias: "Alert when door is left open"
              description: "Plays an alert on the media player when a door sensor has been in the 'on' state for a specified duration."
              variables:
                door_sensor:
                  name: Door Sensor
                  description: The binary sensor entity that indicates the door is open.
                  selector:
                    entity:
                      domain: binary_sensor
                alert_media:
                  name: Alert Media
                  description: The media player entity and the media content ID to play.
                  selector:
                    media:
                open_duration:
                  name: Duration
                  description: The amount of time the door must remain open before alerting.
                  selector:
                    duration:
              trigger:
                - platform: state
                  entity_id: "{{ variables.door_sensor }}"
                  to: "on"
                  for: "{{ variables.open_duration }}"
              action:
                - service: media_player.play_media
                  target:
                    entity_id: "{{ variables.alert_media.entity_id }}"
                  data:
                    media_content_id: "{{ variables.alert_media.media_content_id }}"
              mode: single
          ```
        thinking_content: |-
          1.  **Understand the Goal**: The user wants a Home Assistant Blueprint that triggers an alert (plays media) when a specific door sensor remains "open" (or "on", "open", "true") for a specified duration.

          2.  **Analyze the Requirements**:
              *   **Input**: `door_sensor` (Entity Selector: binary_sensor).
              *   **Input**: `alert_media` (Media Selector: media_player + media id).
              *   **Input**: `open_duration` (Duration Selector).
              *   **Trigger**: `door_sensor` is `open` (True) for the duration defined by `open_duration`.
              *   **Action**: Play the media defined by `alert_media`.

          3.  **Determine the Logic**:
              *   Standard automation structure.
              *   **Trigger**: We need a template trigger or a binary sensor trigger with a delay.
              *   *Option A (Template Trigger)*: A bit complex for beginners to read, but cleaner for logic.
              *   *Option B (Delay Trigger)*: This is usually the most intuitive way to handle "wait X time". Trigger = State change to `on` -> Delay = `open_duration` -> Action = Play Media.

          4.  **Drafting the Blueprint (Mental or Scratchpad)**:

              *   `alias`: "Alert when door is left open"
              *   `trigger`:
                  *   Platform: `state`
                  *   Entity: `[door_sensor]`
                  *   To: `on`
              *   `variables`:
                  *   Need to extract the time value from the duration input. The duration input is usually a string like "PT30M". I need to convert this to a delay duration string.
                  *   The blueprint input syntax for duration usually returns a specific string format or a dict depending on the version of Home Assistant (Core 2022.12+ vs older).
                  *   *Assumption*: Modern Home Assistant (Blueprints support duration selector) usually provides a string like "PT30M" or "30 minutes".
                  *   *Refined approach*: If the input is "duration", the variable usually holds a dict with `duration`, `duration_seconds`, etc., depending on how the UI renders it in the blueprint editor, but often a blueprint variable from a duration selector stores the *duration* as a string representation or an object. Let's look at standard duration variable usage.
                  *   *Correction*: In Blueprint `variable` section, selecting `duration` usually creates a variable. In the trigger `delay` field, you can use `{{ variables.open_duration }}` directly if it supports strings, or you need to extract the time.
                  *   *Wait*, the `delay` platform accepts a duration string (e.g., "00:00:30:00"). The input `open_duration` is likely a string like "PT30M".
                  *   Actually, looking at common HACs patterns for this:
                      *   Input: `open_duration` -> "PT30M" (ISO 8601) or "00:00:30:00" (Home Assistant format).
                      *   If it's a variable from a Duration selector in Blueprint UI: It usually provides `duration` in the variable object.
                      *   Let's assume the standard simplified variable usage: The input provides a duration string.
                      *   *Self-Correction*: The easiest way to handle a duration input in a delay trigger is to use the variable provided by the selector directly if it resolves correctly, or use a template.
                      *   *Let's stick to the most reliable method*:
                          *   `trigger`: state change to `on`.
                          *   `delay`: `{{ variables.open_duration }}` (Home Assistant allows string durations in delays).
              *   `action`:
                  *   Service: `media_player.play_media`
                  *   Data: `entity_id: [alert_media]`, `media_content_id: [alert_media]`.

          5.  **Refining the Trigger**:
              *   The requirement says "When the door is ajar...".
              *   Binary Sensor states are usually `on` or `off` (or `open`/`closed`). I will use `on` to be safe, as it's the standard boolean state.

          6.  **Handling the Duration Variable**:
              *   In modern Home Assistant (Core 2023.1+), the duration variable from the selector is a dictionary `{'duration': 'PT30M'}` or similar.
              *   However, in the Blueprint UI's variables section, a selector of type `duration` usually creates a variable that holds the *duration string* directly in some versions, or a dict.
              *   To be safe and generic:
                  *   If using `delay` in automation, `{{ variables.open_duration }}` usually works if the input was a duration selector (which returns a string like "PT30M").
                  *   Alternatively, use `{{ variables.open_duration.duration }}`.
                  *   *Safest bet*: Assume the variable holds the string "PT30M" or similar time string recognized by the delay platform. If I write `{{ variables.open_duration }}`, it usually works for ISO 8601 durations (PT30M) or HH:MM:SS:SS formats depending on HA version.

          7.  **Finalizing the Structure**:

              ```yaml
              blueprints:
                - name: Alert when door is left open
                  description: Play an alert when a door sensor is open for a set duration.
                  variables:
                    door_sensor:
                      name: Door Sensor
                      description: The binary sensor that indicates the door is open.
                      selector:
                        entity:
                          domain: binary_sensor
                    alert_media:
                      name: Alert Media
                      description: The media player and alert content.
                      selector:
                        media:
                    open_duration:
                      name: Duration
                      description: How long the door must remain open before alerting.
                      selector:
                        duration:
                  trigger:
                    - platform: state
                      entity_id: "{{ variables.door_sensor }}"
                      to: "on"
                      for: "{{ variables.open_duration }}" # Wait, 'for' is cleaner!
                  action:
                    - service: media_player.play_media
                      target:
                        entity_id: "{{ variables.alert_media }}"
                      data:
                        media_content_id: "{{ variables.alert_media }}"
                  mode: single
              ```

          8.  **Correction on Trigger Logic**:
              *   The user requirement says "play an alert... when the door is *left* open for more than X minutes".
              *   The `for:` trigger modifier is exactly for this.
              *   Trigger: State changes to `on`.
              *   For: `open_duration`.
              *   Action: Play Media.

          9.  **Double Check Variable `alert_media`**:
              *   The prompt asks for `alert_media` to be "The target for the media selector for the media player and media id".
              *   This is the "Media" selector in Blueprints.
              *   When you use the `media` selector, the variable contains both the entity_id and the media content_id.
              *   So `target` entity_id is `{{ variables.alert_media }}`.
              *   Data media_content_id is `{{ variables.alert_media }}`.
              *   This seems correct.

          10. **Code Construction**:

              ```yaml
              blueprints:
                - alias: "Door Left Open Alert"
                  description: "Plays an alert on the speaker when the door has been left open for a specified duration."
                  variables:
                    door_sensor:
                      name: Door Sensor
                      description: The binary_sensor entity that detects if the door is open.
                      selector:
                        entity:
                          domain: binary_sensor
                    alert_media:
                      name: Alert Media
                      description: The media player entity and media content ID to play.
                      selector:
                        media:
                    open_duration:
                      name: Duration
                      description: How long the door must remain open before alerting.
                      selector:
                        duration:
                  trigger:
                    - platform: state
                      entity_id: "{{ variables.door_sensor }}"
                      to: "on"
                      for: "{{ variables.open_duration }}"
                  action:
                    - service: media_player.play_media
                      target:
                        entity_id: "{{ variables.alert_media }}"
                      data:
                        media_content_id: "{{ variables.alert_media }}"
                  mode: single
              ```

          11. **Review against constraints**:
              *   Input `door_sensor`: Yes, entity selector.
              *   Input `alert_media`: Yes, media selector.
              *   Input `open_duration`: Yes, duration selector.
              *   Play alert when open: Yes, triggered by state `on` with `for`.
              *   Plain text, simple, to the point: Yes.

          12. **Final Polish**: Ensure the YAML indentation is correct. The `for` logic is the cleanest solution for "left open for X time".

              One edge case: What if the sensor is already `on` when the automation starts?
              *   If the sensor is already `on`, the state change trigger doesn't fire.
              *   The `for` modifier waits until the condition is met. If it is already met, it triggers immediately.
              *   *However*, the requirement says "left open". If I open the door and immediately set the sensor, `for: 30m` won't trigger because the condition `to: on` isn't met *yet* if the sensor is just state. Wait, `for` waits until the state is reached.
              *   Actually, if the door is *already* open (sensor `on`), `to: on` is already true. The trigger waits until the condition `for X` is true. If it's already true, it triggers immediately.
              *   But usually, these automations are triggered by opening the door.
              *   If the requirement implies "If I open the door and walk away", the state change trigger works perfectly.

              Alternative: `state` -> `to: "on"` with `for`.
              This is the standard way to handle "wait until X happens".

              Let's confirm the media selector variable structure.
              The media selector usually produces a dictionary: `{'entity_id': '...', 'media_content_id': '...'}`.
              If so, `{{ variables.alert_media }}` would put the dictionary into `entity_id` (which might not work if the service target expects a list or if the media_content_id data field expects the string).
              Actually, looking at HACS examples, the `media` selector usually fills the variable with the media content string directly in some contexts, or a dict.
              Let's check the `media_player.play_media` service.
              `target` needs `entity_id`.
              `data` needs `media_content_id`.
              If `alert_media` is a dict `{'entity_id': '...', 'media_content_id': '...'}`, then `{{ variables.alert_media.entity_id }}` and `{{ variables.alert_media.media_content_id }}` are needed.
              However, if the selector returns the media content ID string itself (common in older blueprints or specific configurations), it's different.
              *Correction*: The Home Assistant "Media" selector returns the *media content* (the URL/ID) typically.
              Let's look at the prompt: "The target for the media selector for the media player and media id".
              If I use the `media` selector variable `m`, it usually contains the `entity_id` and `media_content_id` combined or separate.
              Actually, in the current Blueprint UI, a media selector variable acts as both.
              But to be safe and compatible with the service definition `media_player.play_media` (which takes `target` and `data`), I should extract them.
              *However*, often in these simple prompts, users want the simplest YAML.
              If I look at how the media selector works in variables:
              It often results in `{'entity_id': '...', 'media_content_id': '...'}`.
              If I just write `{{ variables.alert_media }}` in the `entity_id` slot, it passes the dict. Home Assistant 2023+ might accept that.
              But strictly, `media_content_id` is needed.
              To be robust, I will use `{{ variables.alert_media.entity_id }}` and `{{ variables.alert_media.media_content_id }}`.
              *Wait*, actually, many blueprints simply use `{{ variables.alert_media }}` for `media_content_id` if the selector provides the media ID string.
              Let's stick to the most standard interpretation: The `media` selector provides the media content ID.
              *Let's check the exact selector behavior*: The `media` selector returns a `string` in the variable representing the media content ID. It does *not* return the entity ID.
              *Correction*: Actually, looking at HACS blueprints, the "Media" selector *does* include the entity_id in the variable name or structure depending on the version.
              To be safe, I will assume the variable holds the full media object (entity_id + media_id) because the prompt says "target for the media selector for the media player *and* media id".
              So `{{ variables.alert_media.entity_id }}` and `{{ variables.alert_media.media_content_id }}` is the most correct way.

              *Wait*, looking at the Home Assistant docs for blueprints selectors:
              `media` selector: "Select a media player and media content".
              Variable: `{entity_id: ..., media_content_id: ...}`.
              So I will use the dot notation.

              Revised Action:
              ```yaml
              - service: media_player.play_media
                target:
                  entity_id: "{{ variables.alert_media.entity_id }}"
                data:
                  media_content_id: "{{ variables.alert_media.media_content_id }}"
              ```

              One final check on `trigger`.
              `to: "on"`
              `for: "{{ variables.open_duration }}"`
              This ensures it waits exactly the duration specified.

              This looks solid.

              Final Output Generation.
        tool_calls: null
        native: null
        created: 2026-01-27 17:28:31.628434+00:00
      tools: null
    timestamp: 2026-01-27 17:27:59.366692+00:00
  duration_ms: 32263.108
  tries: 1
