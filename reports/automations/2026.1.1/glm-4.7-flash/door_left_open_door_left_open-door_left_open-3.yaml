---
uuid: c7c7483e-8a1c-4c4b-9005-ba4d924d0253
task_id: door_left_open_door_left_open-door_left_open-3
model_id: glm-4.7-flash
category: media_player
task:
  input_text: |
    # Door left open

    ## Problem statement

    Create an blueprint automation to play an alert on the speaker when the door is
    left open.

    ## Example use cases

    These are example use cases that could be used with the blueprint:

    - Play an message on the living room speaker if the garage door has been left open for more than 30 minutes
    - When the front door is ajar for 5 minutes, play a sound on the kitchen bluetooth speaker.

    ## Detailed Description

    The blueprint should accept two inputs:

    | Input           | Selector Type | Description                                                                           |
    | --------------- | ------------- | ------------------------------------------------------------------------------------- |
    | `door_sensor`   | `entity`      | A `binary_sensor` entity selector door sensor that is the target of the automation.   |
    | `alert_media`   | `media`       | The target for the `media` selector for the media player and media id with the alter. |
    | `open_duration` | `duration`    | A `duration` selector, the amount of time before playing the alert.                   |

    The automation should play the selected media when the door has been open for the specified duration.
response: |-
  ```yaml
  blueprints:
    - name: "Alert when door left open"
      domain: automation

      input_selectors:
        door_sensor:
          entity:
            domain: binary_sensor
            device_class: door
        alert_media:
          media:
            domain: media_player
        media_content_id:
          text:
            default: "sound.alert"
        open_duration:
          duration:
            default: "00:30:00"

      automation:
        trigger:
          - platform: state
            entity_id: input_selectors.door_sensor
            to: "on"
            for: "{{ open_duration }}"

        action:
          - service: media_player.play_media
            target:
              entity_id: "{{ alert_media }}"
            data:
              media_content_id: "{{ media_content_id }}"
  ```
context:
  conversation_trace:
  - event_type: async_process
    data:
      text: |
        # Door left open

        ## Problem statement

        Create an blueprint automation to play an alert on the speaker when the door is
        left open.

        ## Example use cases

        These are example use cases that could be used with the blueprint:

        - Play an message on the living room speaker if the garage door has been left open for more than 30 minutes
        - When the front door is ajar for 5 minutes, play a sound on the kitchen bluetooth speaker.

        ## Detailed Description

        The blueprint should accept two inputs:

        | Input           | Selector Type | Description                                                                           |
        | --------------- | ------------- | ------------------------------------------------------------------------------------- |
        | `door_sensor`   | `entity`      | A `binary_sensor` entity selector door sensor that is the target of the automation.   |
        | `alert_media`   | `media`       | The target for the `media` selector for the media player and media id with the alter. |
        | `open_duration` | `duration`    | A `duration` selector, the amount of time before playing the alert.                   |

        The automation should play the selected media when the door has been open for the specified duration.
      context:
        id: 01KG080880NZZ2YGAQX0XCW9EZ
        parent_id: null
        user_id: null
      conversation_id: null
      device_id: null
      satellite_id: null
      language: en
      agent_id: conversation.mock_title
      extra_system_prompt: null
    timestamp: 2026-01-27 17:28:43.008799+00:00
  - event_type: agent_detail
    data:
      messages:
      - role: system
        content: |-
          You are a voice assistant for Home Assistant.
          Answer questions about the world truthfully.
          Answer in plain text. Keep it simple and to the point.
          Current time is 09:28:43. Today's date is 2026-01-27.
        created: 2026-01-27 17:28:43.009899+00:00
      - role: user
        content: |
          # Door left open

          ## Problem statement

          Create an blueprint automation to play an alert on the speaker when the door is
          left open.

          ## Example use cases

          These are example use cases that could be used with the blueprint:

          - Play an message on the living room speaker if the garage door has been left open for more than 30 minutes
          - When the front door is ajar for 5 minutes, play a sound on the kitchen bluetooth speaker.

          ## Detailed Description

          The blueprint should accept two inputs:

          | Input           | Selector Type | Description                                                                           |
          | --------------- | ------------- | ------------------------------------------------------------------------------------- |
          | `door_sensor`   | `entity`      | A `binary_sensor` entity selector door sensor that is the target of the automation.   |
          | `alert_media`   | `media`       | The target for the `media` selector for the media player and media id with the alter. |
          | `open_duration` | `duration`    | A `duration` selector, the amount of time before playing the alert.                   |

          The automation should play the selected media when the door has been open for the specified duration.
        attachments: null
        created: 2026-01-27 17:28:43.008856+00:00
      - role: assistant
        agent_id: conversation.mock_title
        content: |-
          ```yaml
          blueprints:
            - name: "Alert when door left open"
              domain: automation

              input_selectors:
                door_sensor:
                  entity:
                    domain: binary_sensor
                    device_class: door
                alert_media:
                  media:
                    domain: media_player
                media_content_id:
                  text:
                    default: "sound.alert"
                open_duration:
                  duration:
                    default: "00:30:00"

              automation:
                trigger:
                  - platform: state
                    entity_id: input_selectors.door_sensor
                    to: "on"
                    for: "{{ open_duration }}"

                action:
                  - service: media_player.play_media
                    target:
                      entity_id: "{{ alert_media }}"
                    data:
                      media_content_id: "{{ media_content_id }}"
          ```
        thinking_content: |-
          1.  **Analyze the Request:**
              *   **Goal:** Create a Home Assistant Blueprint automation.
              *   **Trigger:** A specific door sensor remains `on` (open) for a specified duration.
              *   **Action:** Play a specific media file on a specific media player.
              *   **Inputs (Blueprint Parameters):**
                  *   `door_sensor` (Entity): The binary sensor for the door.
                  *   `alert_media` (Media): The target media player *and* the media ID to play (e.g., `media_player.kitchen, media.sound.alert`).
                  *   `open_duration` (Duration): How long the door must be open (e.g., `00:05:00` for 5 minutes).

          2.  **Determine the Logic:**
              *   I need to track how long the door sensor has been `on`.
              *   *Approach 1 (Trigger Condition):* `for: "00:05:00"` in the trigger. This works well if the sensor stays `on` continuously. However, if the user opens and closes it multiple times within that window, the `for` condition might fail or reset depending on implementation.
              *   *Approach 2 (State Trigger + Condition):* Trigger when the door opens (`state: 'on'`) AND the `for` condition triggers.
              *   *Approach 3 (Time Difference):* This is the most robust way to handle edge cases (like opening and closing slightly). Use a helper variable to store the `last_changed` time, or use the built-in `state` trigger with `for` *if* we assume the door won't be toggled off and on within that duration.
              *   *Refined Approach for "Left Open":* Usually, if a door is left open, it stays open. The standard `for` trigger in Home Assistant is the cleanest solution for a blueprint.
              *   *Blueprint Parameters:* I need to define `door_sensor`, `alert_media`, and `open_duration` using the `input_selectors` dictionary.

          3.  **Drafting the Blueprint Structure:**

              *   **Blueprint Info:**
                  *   `name`: "Alert when door left open"
                  *   `domain`: `automation`

              *   **Input Selectors:**
                  *   `door_sensor`: `{'entity': {'domain': 'binary_sensor'}}` (Assuming binary_sensor, though text prompt says "door sensor", usually implies binary_sensor. I'll stick to binary_sensor for `on` state).
                  *   `alert_media`: `{'media': {'domain': 'media_player'}}` + Custom property for Media ID? Wait, the `media` selector usually selects the *entity*. The prompt says: "The target for the `media` selector for the media player *and* media id". The Home Assistant `input_selectors` don't have a selector type that maps to *both* entity and media ID in one parameter easily without customizing the input selector logic.
                  *   *Correction on `alert_media`:* The prompt asks for `alert_media` to be a `media` selector containing "media player and media id".
                  *   Let's look at the Home Assistant API. There is no built-in selector that returns `{'entity_id': '...', 'media_content_id': '...'}`.
                  *   *Workaround:* I will define `alert_media` as a `media` selector for the *player*. To get the media id, I usually need a separate input or a complex selector. However, the prompt implies a single input parameter. I will define `alert_media` as a `media` selector targeting the player, and perhaps add a `media_content_id` input separately? No, the table says one column `alert_media`.
                  *   *Alternative:* Use a `input_select` or `input_text` for the full string? No, the table specifies `media`.
                  *   *Interpretation:* I will use a custom selector logic or simply map the `media` selector to the entity and assume the media ID is hardcoded or passed in the command string, but the prompt specifically asks for it as an input selector.
                  *   *Strict interpretation:* I will provide `alert_media` as a `media` selector targeting the player. I will *also* provide `media_content_id` as an input in the blueprint, even though the prompt table implies one column. Wait, the prompt says: "The target for the `media` selector for the media player *and* media id".
                  *   Actually, the most common way to do this in blueprints without custom UI components is to separate them or use a custom selector string.
                  *   *Simplification:* I'll create `alert_media_player` and `alert_media_id` as inputs to ensure robustness, OR I will try to fit it into the single `alert_media` selector if the user implies a custom entity type.
                  *   *Let's stick to the prompt's table exactly:*
                      *   `door_sensor`: `entity`
                      *   `alert_media`: `media` (This usually just gives the player).
                      *   `open_duration`: `duration`
              *   *Constraint Check:* If I strictly follow `{'media': ...}`, I only get the entity. I can't pass the media ID easily in that selector object structure.
              *   *Solution:* I will define `alert_media` as the `media` selector (for the player). I will add a separate input `media_content_id` (optional or strictly required?) because the prompt explicitly asks for "media player and media id". If I only use the selector, I lose the ID.
              *   *Re-reading prompt:* "The target for the `media` selector for the media player and media id".
              *   Okay, I will define `alert_media` as a custom entity selector or just map the `media` selector to the player and add `media_content_id` as a separate input to make it work. *Self-correction:* The prompt lists specific inputs in a table. I will stick to the table inputs but I'll add `media_content_id` as a separate input because it's technically necessary for the logic to function, or I will try to construct the string.
              *   *Decision:* I will define `alert_media` as a `media` selector (targeting the player) and add `media_content_id` as a separate input for the media to play. It's better UX than forcing the user to type a custom string in a selector.

              *   **The Automation:**
                  *   **Trigger:** State of `door_sensor` -> ON.
                  *   **Condition:** `for: {{ open_duration }}` (This waits for the duration).
                  *   **Action:** Service `media_player.play_media` on `alert_media` with data `media_content_id: {{ media_content_id }}`.

          4.  **Refining the Input Selector for `alert_media`:**
              *   To strictly follow "The target for the `media` selector", I use `{'media': {'domain': 'media_player'}}`.
              *   I *must* add `media_content_id` as an input. The prompt table is slightly ambiguous on whether it's strictly one column or implies the selector handles both. Given standard HA limitations, I will add `media_content_id` to the inputs list to make it valid, or I'll combine them into a string if I want to be pedantic about the table. But the selector approach is best practice. I'll add `media_content_id` as a `input_text` or `input_select` or `string`. Let's use `string` for `media_content_id`.

          5.  **Writing the Code:**

              ```yaml
              blueprints:
                - name: "Door Left Open Alert"
                domain: automation
                input_selectors:
                  door_sensor:
                    entity:
                      domain: binary_sensor
                      device_class: door
                  alert_media:
                    media:
                      domain: media_player
                  media_content_id:
                    text:
                      default: "sound.alert" # Good default
                  open_duration:
                    duration:
                      default: "00:30:00"
                automation:
                  trigger:
                    - platform: state
                      entity_id: input_selectors.door_sensor
                      to: 'on'
                      for: "{{ open_duration }}"
                  action:
                    - service: media_player.play_media
                      target:
                        entity_id: "{{ alert_media }}"
                      data:
                        media_content_id: "{{ media_content_id }}"
              ```

          6.  **Review against constraints:**
              *   "The automation should play the selected media when the door has been open for the specified duration." -> Yes, `for: "{{ open_duration }}"` handles this.
              *   Inputs match table? `door_sensor` (entity), `alert_media` (media), `open_duration` (duration). I added `media_content_id` because `alert_media` selector alone cannot carry the media ID. I will add a note or just include it as a necessary input. *Wait*, maybe I can use a `select` selector for the media ID? Or `input_text`. I'll use `input_text` for `media_content_id` to ensure it's flexible.

              *Let's try to interpret `alert_media` in the table as "The target for the media selector (the player) AND the media id".* Since HA selectors don't do that, I will split it in the blueprint but keep the structure. Actually, looking at common Blueprints, `media_player` and `media_content_id` are usually separate.

              *Correction:* I'll assume the user might want to select the media ID from a list or type it. I'll add `media_content_id` as a `text` input.

              *Refining the Automation Trigger:*
              If the door sensor is toggled OFF and ON within the duration, the `for` trigger resets. This is acceptable for "Left Open" scenarios where you don't usually open/close it repeatedly in a 30-minute window.

          7.  **Final Polish:**
              *   Blueprints indentation.
              *   Clear variable names.
              *   Description included.

              ```yaml
              blueprints:
                - name: Door Left Open Alert
                domain: automation

                input_selectors:
                  door_sensor:
                    entity:
                      domain: binary_sensor
                      device_class: door # Good practice to filter by door class
                  alert_media:
                    media:
                      domain: media_player
                  open_duration:
                    duration:
                      default: "00:30:00"
                  media_content_id:
                    text:
                      default: "sound.alert"

                automation:
                  trigger:
                    - platform: state
                      entity_id: input_selectors.door_sensor
                      to: "on"
                      for: "{{ open_duration }}"

                  action:
                    - service: media_player.play_media
                      target:
                        entity_id: "{{ alert_media }}"
                      data:
                        media_content_id: "{{ media_content_id }}"
              ```

              *Self-Correction on Inputs:* The prompt table says: `alert_media` is the `media` selector. It implies the user selects the media *file* using that selector? No, usually media selectors select the *device*. To select a specific media file, you usually need the ID.
              I will add `media_content_id` as a separate input to ensure the logic works, as it's standard for Blueprints.

              Let's check if I can put the media ID inside the `media` selector. No, `media` selector returns `{"entity_id": "media_player.kitchen"}`.
              I will stick with adding `media_content_id`.

              *Wait, is there a way to use the `media` selector to define both?*
              There is a custom selector called `entity` which has `filter: domain: media_player`.
              I will use the inputs defined in the table.
              `door_sensor` -> `entity`
              `alert_media` -> `media` (Target player)
              `open_duration` -> `duration`

              I will *also* define `media_content_id` as a separate input, but since the prompt didn't explicitly ask for it in the table, I should check if I can hardcode a default or if I should stick to the prompt.
              The prompt says "Answer questions... truthfully". If the input table doesn't support the media ID, the blueprint is incomplete without an extra step or input. I will add `media_content_id` as an optional input for completeness, or I will assume the user puts the ID in the selector? No, that's not possible.
              Actually, I will define `alert_media` as the target *and* I'll assume the user might need to define the media ID separately. I'll add `media_content_id` to the inputs for robustness.

              *Actually, let's look at the selector definition.*
              `media`: The `media` selector type.
              If I use `input_selectors.door_sensor`, `input_selectors.alert_media`, `input_selectors.open_duration`.
              I'll add `media_content_id` as a text input.

              Let's try to make the Blueprint as per the table strictly, but using `input_selectors` for everything.
              I'll add `media_content_id` as a `string` input.

              *Blueprint Logic Check:*
              Trigger: `door_sensor` is `on` for `open_duration`.
              Action: `alert_media` plays `media_content_id`.

              *Code Structure:*
              ```yaml
              blueprints:
                - name: Door Left Open Alert
                domain: automation

                input_selectors:
                  door_sensor:
                    entity:
                      domain: binary_sensor
                      device_class: door
                  alert_media:
                    media:
                      domain: media_player
                  media_content_id:
                    text:
                      default: "sound.alert" # Required to make the selector work
                  open_duration:
                    duration:
                      default: "00:30:00"

                automation:
                  trigger:
                    - platform: state
                      entity_id: input_selectors.door_sensor
                      to: "on"
                      for: "{{ open_duration }}"

                  action:
                    - service: media_player.play_media
                      target:
                        entity_id: "{{ alert_media }}"
                      data:
                        media_content_id: "{{ media_content_id }}"
              ```

              The prompt asks for "Answer in plain text. Keep it simple and to the point."

              I will present the YAML.
        tool_calls: null
        native: null
        created: 2026-01-27 17:29:15.762141+00:00
      tools: null
    timestamp: 2026-01-27 17:28:43.009906+00:00
  duration_ms: 32753.483
  tries: 1
