---
uuid: 73d9782e-518d-4f19-8318-66b3a7fde7ad
task_id: light_on_door_light_on_door-light_on_door-1
model_id: glm-4.7-flash
category: light
task:
  input_text: |
    # Light on door

    ## Problem statement

    Create an blueprint automation to turn on a light when the door opens.

    ## Example use cases

    These are example use cases that could be used with the blueprint:

    - Turn on the pantry light when the pantry door opens

    ## Detailed Description

    The blueprint should accept two inputs:

    | Input          | Description                                                                     |
    | -------------- | ------------------------------------------------------------------------------- |
    | `door_sensor`  | A `binary_sensor` that triggers the automation to start.                        |
    | `light_switch` | One or more `light` entity targets to turn on or off when the automation fires. |

    The automation should trigger when the door opens, and turn the light on. The
    light should be shut off when the door closes or after a 2 minute timeout.
response: |-
  ```yaml
  blueprints:
    automation:
      name: Light on door
      description: Turns on a light when a door opens, and turns it off when the door closes or after a 2-minute timeout.
      fields:
        door_sensor:
          name: Door Sensor
          description: The binary sensor that triggers when the door opens or closes.
          selector:
            entity:
              domain: binary_sensor
        light_switch:
          name: Light Switch
          description: The light entity(s) to turn on or off.
          selector:
            entity:
              domain: light
      trigger:
        - platform: state
          entity_id: !input door_sensor
          to: "on"
        - platform: state
          entity_id: !input door_sensor
          to: "off"
        - platform: attractor
          trigger: delay
          delay:
            minutes: 2
      action:
        - service: light.turn_on
          target:
            entity_id: !input light_switch
        - service: light.turn_off
          target:
            entity_id: !input light_switch
      mode: restart
  ```
context:
  conversation_trace:
  - event_type: async_process
    data:
      text: |
        # Light on door

        ## Problem statement

        Create an blueprint automation to turn on a light when the door opens.

        ## Example use cases

        These are example use cases that could be used with the blueprint:

        - Turn on the pantry light when the pantry door opens

        ## Detailed Description

        The blueprint should accept two inputs:

        | Input          | Description                                                                     |
        | -------------- | ------------------------------------------------------------------------------- |
        | `door_sensor`  | A `binary_sensor` that triggers the automation to start.                        |
        | `light_switch` | One or more `light` entity targets to turn on or off when the automation fires. |

        The automation should trigger when the door opens, and turn the light on. The
        light should be shut off when the door closes or after a 2 minute timeout.
      context:
        id: 01KG087Y5NVGVP6WXFQFV979VF
        parent_id: null
        user_id: null
      conversation_id: null
      device_id: null
      satellite_id: null
      language: en
      agent_id: conversation.mock_title
      extra_system_prompt: null
    timestamp: 2026-01-27 17:32:54.837960+00:00
  - event_type: agent_detail
    data:
      messages:
      - role: system
        content: |-
          You are a voice assistant for Home Assistant.
          Answer questions about the world truthfully.
          Answer in plain text. Keep it simple and to the point.
          Current time is 09:32:54. Today's date is 2026-01-27.
        created: 2026-01-27 17:32:54.839158+00:00
      - role: user
        content: |
          # Light on door

          ## Problem statement

          Create an blueprint automation to turn on a light when the door opens.

          ## Example use cases

          These are example use cases that could be used with the blueprint:

          - Turn on the pantry light when the pantry door opens

          ## Detailed Description

          The blueprint should accept two inputs:

          | Input          | Description                                                                     |
          | -------------- | ------------------------------------------------------------------------------- |
          | `door_sensor`  | A `binary_sensor` that triggers the automation to start.                        |
          | `light_switch` | One or more `light` entity targets to turn on or off when the automation fires. |

          The automation should trigger when the door opens, and turn the light on. The
          light should be shut off when the door closes or after a 2 minute timeout.
        attachments: null
        created: 2026-01-27 17:32:54.838010+00:00
      - role: assistant
        agent_id: conversation.mock_title
        content: |-
          ```yaml
          blueprints:
            automation:
              name: Light on door
              description: Turns on a light when a door opens, and turns it off when the door closes or after a 2-minute timeout.
              fields:
                door_sensor:
                  name: Door Sensor
                  description: The binary sensor that triggers when the door opens or closes.
                  selector:
                    entity:
                      domain: binary_sensor
                light_switch:
                  name: Light Switch
                  description: The light entity(s) to turn on or off.
                  selector:
                    entity:
                      domain: light
              trigger:
                - platform: state
                  entity_id: !input door_sensor
                  to: "on"
                - platform: state
                  entity_id: !input door_sensor
                  to: "off"
                - platform: attractor
                  trigger: delay
                  delay:
                    minutes: 2
              action:
                - service: light.turn_on
                  target:
                    entity_id: !input light_switch
                - service: light.turn_off
                  target:
                    entity_id: !input light_switch
              mode: restart
          ```
        thinking_content: |-
          1.  **Analyze the Request:**
              *   **Goal:** Create a Home Assistant Blueprint automation.
              *   **Trigger:** A specific binary sensor (door) changing state to "on" (opens).
              *   **Action:** Turn on a specific light.
              *   **Deactivation/Conditions:** Turn off the light if the door closes OR if it stays on for 2 minutes.
              *   **Inputs:** `door_sensor` (binary_sensor), `light_switch` (light).
              *   **Output Format:** Plain text, simple, to the point.

          2.  **Identify Components:**
              *   **Type:** `automation` (Blueprint).
              *   **Input:**
                  *   `door_sensor`: `binary_sensor: []`
                  *   `light_switch`: `light: []`
              *   **Trigger:** `state:`
                  *   Entity: `{{ door_sensor }}`
                  *   To: `on`
              *   **Conditions:**
                  *   Trigger: `state:`
                      *   Entity: `{{ door_sensor }}`
                      *   To: `off` (implied: when it goes off, we want to turn off the light).
                  *   *Self-Correction on Conditions:* The problem statement says "shut off when the door closes". So, a trigger on the door closing that turns off the light is simpler and cleaner than a condition checking if the door is closed. However, I can also just rely on the state change of the door *to off* as the trigger.
              *   **Action:**
                  *   Turn on: `service: light.turn_on`, `target: {{ light_switch }}`
                  *   Turn off: `service: light.turn_off`, `target: {{ light_switch }}`
              *   **Timeout Logic:** The prompt asks to shut off "after a 2 minute timeout".
                  *   To do this inside a blueprint automation, I need an `attractor` trigger.
                  *   Trigger: `attractor` -> Trigger: `delay`, `duration: '00:02:00'`.

          3.  **Drafting the Blueprint Structure:**

              ```yaml
              blueprints:
                automation:
                  name: Light on door
                  description: Turn on a light when a door opens and turn it off when the door closes or after 2 minutes.
                  variables:
                    door_sensor: !input door_sensor
                    light_switch: !input light_switch
                  trigger:
                    - platform: state
                      entity_id: !input door_sensor
                      to: 'on' # Door opens
                    - platform: state
                      entity_id: !input door_sensor
                      to: 'off' # Door closes
                    - platform: attractor
                      trigger: delay
                      delay:
                        hours: 0
                        minutes: 2
                        seconds: 0
                  condition: []
                  action:
                    - service: light.turn_on
                      target:
                        entity_id: !input light_switch
                    - service: light.turn_off
                      target:
                        entity_id: !input light_switch
                  mode: restart # or single? restart is usually safer for sequential actions.
              ```

          4.  **Refining the Logic:**
              *   When the door opens (`on`), turn on the light.
              *   When the door closes (`off`), turn off the light.
              *   When the 2-minute timer runs out, turn off the light.

              *Wait, logic check:*
              If I turn off the light on "door closes", I don't necessarily need the 2-minute timeout *unless* the door doesn't close (e.g., it stays open, or user walks in and closes it, but the light should turn off regardless). The prompt explicitly asks for the timeout. So I must include the `attractor` trigger.

              *Trigger Sequence:*
              1.  `door_sensor` is `on` -> Turn Light On.
              2.  `door_sensor` is `off` -> Turn Light Off.
              3.  Attractor (2 mins delay) -> Turn Light Off.

          5.  **Formatting for Output:**
              *   Home Assistant Blueprints use specific YAML indentation.
              *   I need to provide the YAML code block.

          6.  **Constructing the YAML (Mental Draft):**

              ```yaml
              blueprints:
                automation:
                  alias: Light on door
                  description: Turn on a light when the door opens and turn it off when the door closes or after 2 minutes.
                  fields:
                    door_sensor:
                      name: Door Sensor
                      description: Binary sensor that detects door opening/closing.
                      selector:
                        entity:
                          domain: binary_sensor
                    light_switch:
                      name: Light Switch
                      description: Light entity to control.
                      selector:
                        entity:
                          domain: light
                  trigger:
                    - platform: state
                      entity_id: !input door_sensor
                      to: "on"
                    - platform: state
                      entity_id: !input door_sensor
                      to: "off"
                    - platform: attractor
                      trigger: delay
                      delay:
                        minutes: 2
                  action:
                    - service: light.turn_on
                      target:
                        entity_id: !input light_switch
                    - service: light.turn_off
                      target:
                        entity_id: !input light_switch
                  mode: restart
              ```

          7.  **Final Review against Constraints:**
              *   Inputs accepted? Yes (`door_sensor`, `light_switch`).
              *   Trigger when door opens? Yes (`to: on`).
              *   Turn on light? Yes (`light.turn_on`).
              *   Shut off when door closes? Yes (`to: off`).
              *   Shut off after 2 mins? Yes (`attractor` trigger).
              *   Plain text? Yes.
              *   Simple and to the point? Yes.

          8.  **Final Polish:** The YAML looks correct. I will output the code block directly.

              *Self-Correction during output generation:* The prompt asks to answer truthfully and simply. I should provide the YAML code block clearly labeled.

              (Double checking the `attractor` syntax in HA 2024+):
              The `attractor` trigger requires `trigger` to be a dictionary, and inside that `delay` object.
              Example: `trigger: - platform: attractor; trigger: delay; delay: 00:02:00`.
              It seems correct.

              Also, note that `light.turn_on` and `light.turn_off` can target multiple lights, so `target: !input light_switch` covers the "One or more" requirement.

              Let's assemble the response.
        tool_calls: null
        native: null
        created: 2026-01-27 17:33:11.435328+00:00
      tools: null
    timestamp: 2026-01-27 17:32:54.839166+00:00
  duration_ms: 16597.516
  tries: 1
